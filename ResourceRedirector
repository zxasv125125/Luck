using System;
using System.IO;
using System.Reflection;
using Microsoft.Xna.Framework.Graphics;
using StardewModdingAPI;
using StardewValley;

namespace EasterEgg
{
    public static class ResourceRedirector
    {
        public static Texture2D ForceLoadFromAssembly(string resourceName, IMonitor monitor)
        {
            try
            {
                Assembly assembly = Assembly.GetExecutingAssembly();
                string fullResourceName = null;
                string[] allResources = assembly.GetManifestResourceNames();

                foreach (string r in allResources)
                {
                    if (r.EndsWith(resourceName, StringComparison.OrdinalIgnoreCase))
                    {
                        fullResourceName = r;
                        break;
                    }
                }

                if (fullResourceName == null)
                {
                    monitor.Log($"[CriticalError] Resource '{resourceName}' not found in DLL assembly.", LogLevel.Error);
                    return null;
                }

                using (Stream stream = assembly.GetManifestResourceStream(fullResourceName))
                {
                    if (stream == null) return null;
                    return Texture2D.FromStream(Game1.graphics.GraphicsDevice, stream);
                }
            }
            catch (Exception ex)
            {
                monitor.Log($"[CriticalError] Failed to force load '{resourceName}': {ex.Message}", LogLevel.Error);
                return null;
            }
        }
    }
}

